if (self.CavalryLogger) { CavalryLogger.start_js(["HOQjl"]); }

__d("ChatSidebarRecentCallsStore",["ChatDispatcher","ChatSidebarRecentCallsActions","FluxReduceStore","immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(b("immutable").Record({calls:b("immutable").List()}));a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b){return a.call(this,b)||this}var d=c.prototype;d.getInitialState=function(){return new g()};d.getParticipants=function(){var a=[];this.getState().calls.forEach(function(b){b=b.participants;a.push.apply(a,b)});return a};d.reduce=function(a,c){switch(c.type){case b("ChatSidebarRecentCallsActions").RECENT_CALLS_UPDATED:return a.set("calls",b("immutable").List(c.calls));default:return a}};return c}(b("FluxReduceStore"));a.__moduleID=e.id;e.exports=new a(b("ChatDispatcher"))}),null);
__d("ChatSidebarDerivedStore",["ChatDispatcher","ChatSidebarPresencePrivacyActions","ChatSidebarPresencePrivacyStore","ChatSidebarRecentCallsStore","ChatSidebarStore","ChatSidebarUserDetailsFactory","ChatUnreadCountStore","FluxDerivedStore","PresencePrivacy","PresenceStatusStore","ShortProfilesStore"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b){b=a.call(this,b)||this;b.$ChatSidebarDerivedStore1();return b}var d=c.prototype;d.$ChatSidebarDerivedStore1=function(){b("PresencePrivacy").subscribe("privacy-user-presence-changed",function(){b("ChatDispatcher").dispatch({type:b("ChatSidebarPresencePrivacyActions").USER_PRESENCE_CHANGED})}),b("PresencePrivacy").subscribe("privacy-changed",function(){b("ChatDispatcher").dispatch({type:b("ChatSidebarPresencePrivacyActions").PRIVACY_CHANGED})}),b("PresencePrivacy").subscribe("privacy-availability-changed",function(){b("ChatDispatcher").dispatch({type:b("ChatSidebarPresencePrivacyActions").PRIVACY_CHANGED})}),b("PresencePrivacy").subscribe("privacy-user-presence-response",function(){b("ChatDispatcher").dispatch({type:b("ChatSidebarPresencePrivacyActions").USER_PRESENCE_CHANGED})})};d.__getStores=function(){return[b("ChatSidebarPresencePrivacyStore"),b("ChatSidebarRecentCallsStore"),b("ChatSidebarStore"),b("ChatUnreadCountStore"),b("PresenceStatusStore"),b("ShortProfilesStore")]};d.__getData=function(a){var c=b("ChatSidebarStore").getExtraData(a),d=b("ChatSidebarStore").getUsersData(c.numTopFriends),e=b("ChatSidebarStore").getState(),f=d.availableUsers,g=d.offlineUsers,h=d.topUsers,i=d.workOthers,j=c.nearby,k=e.isAfterDomLoad,l=b("ChatSidebarRecentCallsStore").getState(),m=b("ChatSidebarRecentCallsStore").getParticipants();return babelHelpers["extends"]({},e,c,d,{maxItemSlots:a,presencePrivacy:b("ChatSidebarPresencePrivacyStore").getState(),recentCalls:l,usersDetailedData:b("ChatSidebarUserDetailsFactory").getUsersDetailedData([].concat(f,j,g,m,h,i),k)})};d.__computeResult=function(a,c){a=c.presencePrivacy.currentUser;return babelHelpers["extends"]({},c,{isUserOffline:a===b("PresencePrivacy").OFFLINE})};d.getVisibleType=function(){return b("ChatSidebarStore").getVisibleType()};return c}(b("FluxDerivedStore"));a.__moduleID=e.id;e.exports=new a(b("ChatDispatcher"))}),null);
__d("BaseChatSidebar.react",["Arbiter","AsyncRequest","Bootloader","ChatConfig","ChatDispatcher","ChatSidebarActions","ChatSidebarCachedViewport","ChatSidebarConstants","ChatSidebarDerivedStore","ChatSidebarVisibility","CSS","DOM","Event","LitestandClassicPlaceHolders","MessengerDivebarSizingTypedLogger","PresencePrivacy","PresenceUtil","React","SidebarAppsInitialVisibility","SidebarType","Style","URI","ViewportBounds","debounceAcrossTransitions","emptyFunction","gkx","ifRequired","onAfterDisplay","onAfterLoadSafe","queryThenMutateDOM","requireWeak"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=44,h=b("ChatSidebarConstants").getItemHeight(),i=8,j="sidebarMode",k=b("ChatConfig").get("expanded_divebar_width"),l=171,m=30,n=300,o=b("ChatConfig").get("sidebar.hide_buddylist_off_homepage"),p="buddylistOff",q=b("ChatSidebarCachedViewport").viewport;function r(a){new(b("AsyncRequest"))("/ajax/chat/settings.php").setHandler(b("emptyFunction")).setErrorHandler(b("emptyFunction")).setData({sidebar_mode:a,window_id:b("PresenceUtil").getSessionID()}).setAllowCrossPageTransition(!0).send()}a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){__p&&__p();var d,e;for(var f=arguments.length,g=new Array(f),h=0;h<f;h++)g[h]=arguments[h];return(d=e=a.call.apply(a,[this].concat(g))||this,e.$2=!1,e.$3=!0,e.$4=b("emptyFunction"),e.$5=b("emptyFunction"),e.state={computedState:b("ChatSidebarDerivedStore").get(c.calculateMaxItemSlots(e.props.heightOffset)),show:!0,pinnedThreads:[]},e.handleDerivedStoreChange=function(){var a=b("ChatSidebarDerivedStore").get(c.calculateMaxItemSlots(e.props.heightOffset));a!==e.state.computedState&&e.setState({computedState:a})},e.handleMouserOut=function(){e.$2=!1,e.$3&&(e.$3=!1,e.$4())},e.handleMouserOver=function(){e.$2=!0},e.handleMouseEnterItem=function(a){b("Bootloader").loadModules(["ChatSidebarHoverCardV2"],function(b){var c=e.state.computedState,d=c.adminedPages.map(function(a){return a.id+""}).filter(Boolean);b.prefetchHoverCardData(a,c.availableUsers.concat(d,c.nearby,c.topUsers,c.workOthers))},"BaseChatSidebar.react")},e.resize=function(a,d){var f,g;b("queryThenMutateDOM")(function(){d&&d(),g=q||{},(!a||a.height!==g.height)&&(f=c.getBodyHeight(e.props.heightOffset))},function(){(!a||a.width!==g.width)&&b("ChatSidebarVisibility").shouldShowSidebar(q,function(a,c){b("ChatSidebarActions").show(a?b("SidebarType").SIDEBAR:b("SidebarType").BUDDYLIST)}),e.adjustToFitHeightFromParams(f)})},e.updateOnActiveTypeahead=function(a,b){e.setState({show:!b})},e.update=function(a){if(!e.shouldSidebarUpdate())return;a?e.handleSizeUpdate():e.handleUsersUpdate()},d)||babelHelpers.assertThisInitialized(e)}c.calculateMaxItemSlots=function(a){return Math.floor((c.getBodyHeight(a)-i)/h)};c.getBodyHeight=function(a){var c=q||b("ChatSidebarVisibility").getViewport(),d=c.height;d-=g;d-=m;d-=a;b("ifRequired")("AppsDivebarDisplayController",function(a){a.isVisible()&&(d-=l)},function(){b("SidebarAppsInitialVisibility").visible&&(d-=l)});return Math.max(0,d)};var d=c.prototype;d.componentDidMount=function(){__p&&__p();var a=this;this.$4=b("debounceAcrossTransitions")(this.update,n,this);this.$5=b("debounceAcrossTransitions")(this.handleDerivedStoreChange,n,this);this.setupStore();this.setupSearchHandler();this.setupSettingHandler();b("Event").listen(window,"resize",function(){var b=babelHelpers["extends"]({},q)||{};a.resizeAndUpdateViewport(b)});b("Arbiter").subscribe("page_transition",function(a,c){b("ChatSidebarVisibility").shouldShowSidebar(q,function(a,d){d=document.documentElement||"";o&&c.uri.getPath()!=="/"?b("CSS").addClass(d,p):(b("CSS").removeClass(d,p),o&&b("Bootloader").loadModules(["Dock"],function(a){a.resizeAllFlyouts()},"BaseChatSidebar.react"));b("ChatSidebarActions").show(a?b("SidebarType").SIDEBAR:b("SidebarType").BUDDYLIST)},c.uri)});b("PresencePrivacy").subscribe("privacy-user-presence-changed",this.resize);this.$1=b("DOM").find(this.props.root,"div.fbChatSidebarBody");var d=c.getBodyHeight(this.props.heightOffset);b("Style").set(this.$1,"height",d+"px");b("onAfterLoadSafe")(function(){__p&&__p();var c=a.state.computedState.visible===b("SidebarType").SIDEBAR;a.resizeAndUpdateViewport();b("onAfterLoadSafe")(function(){c!==(a.state.computedState.visible===b("SidebarType").SIDEBAR)&&b("Bootloader").loadModules(["ChatReliabilityInstrumentation"],function(a){a.logERROR("sidebar flashed")},"BaseChatSidebar.react")});b("Bootloader").loadModules(["AvailableList","AvailableListConstants"],function(b,c){b.subscribe(c.ON_AVAILABILITY_CHANGED,function(){return a.$4()})},"BaseChatSidebar.react");b("gkx")("678258")&&b("Bootloader").loadModules(["WorkChatSidebarUtils"],function(b){b.loadPinnedThreads(function(b){a.setState({pinnedThreads:b})})},"BaseChatSidebar.react")});b("ViewportBounds").addPersistentRight(k);b("Arbiter").inform("sidebar/initialized");b("ChatSidebarActions").init()};d.componentDidUpdate=function(a,b){b.computedState.visible!==this.state.computedState.visible&&this.handleVisibilityChange(this.state.computedState.visible);a=this.state.computedState.presencePrivacy.currentUser!==b.computedState.presencePrivacy.currentUser;this.state.computedState.enabled!==b.computedState.enabled&&r(this.state.computedState.enabled);a&&this.handleSizeUpdate()};d.setupStore=function(){var a=this;b("ChatSidebarDerivedStore").getDependencyStores().forEach(function(a){b("ChatDispatcher").explicitlyRegisterStore(a)});this.props.onRegisterStore&&this.props.onRegisterStore(function(){return a.adjustToFitHeight()});b("ChatSidebarActions").loaded();b("ChatSidebarDerivedStore").addListener(this.$5)};d.setupSettingHandler=function(){var a=this;b("Arbiter").subscribe("chat/option-changed",function(b,c){b=c.name;(b==="hide_groups"||b==="hide_admined_pages"||b==="hide_businesses")&&a.adjustToFitHeight()});b("Arbiter").subscribe(["AppsDivebar/show-apps","AppsDivebar/hide-apps","PagesDivebar/show-pages","PagesDivebar/hide-pages"],function(){return a.adjustToFitHeight()})};d.setupSearchHandler=function(){b("Arbiter").subscribe("sidebar/typeahead/active",this.updateOnActiveTypeahead),b("gkx")("678653")?b("onAfterDisplay")(this.bootloadKeyboardShortcuts.bind(this)):this.bootloadKeyboardShortcuts()};d.bootloadKeyboardShortcuts=function(){var a=this,c=this.props.root;b("Bootloader").loadModules(["KeyboardShortcuts"],function(d){d.register("q",function(d){if(a.$8()!==b("SidebarType").SIDEBAR)return;b("requireWeak")("ChatTypeaheadCore",function(a){a.focusSearchField(c,d)})},{persistOnTransition:!0})},"BaseChatSidebar.react")};d.render=function(){var a=this.state.computedState;return!a.enabled?null:b("React").createElement("div",{onMouseOver:this.handleMouserOver,onMouseOut:this.handleMouserOut},this.props.children({computedState:a,hide:!this.state.show,onMouseEnterItem:this.handleMouseEnterItem,pinnedThreads:this.state.pinnedThreads}))};d.handleVisibilityChange=function(a){switch(a){case b("SidebarType").SIDEBAR:this.show();break;case b("SidebarType").BUDDYLIST:this.hide();break}};d.adjustToFitHeight=function(){var a=this,d;b("queryThenMutateDOM")(function(){d=c.getBodyHeight(a.props.heightOffset)},function(){return a.adjustToFitHeightFromParams(d)})};d.adjustToFitHeightFromParams=function(a){if(!a)return;var c=Math.floor(a-i);this.$4(!0);this.$1&&b("Style").set(this.$1,"height",a+"px");b("Arbiter").inform("sidebar/resized",c,"state");b("Arbiter").inform("reflow")};d.resizeAndUpdateViewport=function(a){this.resize(a,function(){q=b("ChatSidebarVisibility").getViewport()})};d.show=function(){var a=document.documentElement||"";b("CSS").addClass(a,j);b("CSS").removeClass(a,p);o&&b("Bootloader").loadModules(["Dock"],function(a){a.resizeAllFlyouts()},"BaseChatSidebar.react");b("CSS").show(this.props.root);b("Arbiter").inform("sidebar/visibility",!0,"state");b("LitestandClassicPlaceHolders").destroy("sidebar");b("ViewportBounds").inform("change")};d.hide=function(){var a=document.documentElement||"";o&&!this.isOnHomepage()?b("CSS").addClass(a,p):(b("CSS").removeClass(a,p),o&&b("Bootloader").loadModules(["Dock"],function(a){a.resizeAllFlyouts()},"BaseChatSidebar.react"));b("CSS").removeClass(a,j);b("CSS").hide(this.props.root);b("Arbiter").inform("sidebar/visibility",!1,"state");b("Arbiter").inform("reflow");b("ViewportBounds").inform("change")};d.isOnHomepage=function(){return new(b("URI"))(window.location.href).getPath()==="/"};d.$8=function(){return b("ChatSidebarDerivedStore").getVisibleType()};d.shouldSidebarUpdate=function(){if(this.$8()!==b("SidebarType").SIDEBAR||this.$2){this.$2&&(this.$3=!0);return!1}return!0};d.handleSizeUpdate=function(){var a=this,d=c.calculateMaxItemSlots(this.props.heightOffset),e=this.state.computedState;this.setState({computedState:b("ChatSidebarDerivedStore").get(c.calculateMaxItemSlots(this.props.heightOffset))},function(){var c=a.state.computedState,f=c.adminedPages,g=c.isUserOffline,h=c.groups,i=c.nearby,j=c.numTopFriends;c=c.pymmList;if(g!==e.isUserOffline||j!==e.numTopFriends||h.length!==e.groups.length||i.length!==e.nearby.length||f.length!==e.adminedPages.length||((g=c)!=null?(g=g.pages)!=null?g.length:g:g)!==((g=e)!=null?(g=g.pymmList)!=null?(g=g.pages)!=null?g.length:g:g:g)){new(b("MessengerDivebarSizingTypedLogger"))().setMaxItemSlots(d).setSidebarType(b("SidebarType").SIDEBAR).setNumTopFriends(j).setNumNearby(i.length).setNumGroups(h.length).setNumAdminedPages(f.length).setNumPymm(((g=c)!=null?(g=g.pages)!=null?g.length:g:g)||0).log()}})};d.handleUsersUpdate=function(){var a=this.state.computedState.maxItemSlots;a=b("ChatSidebarDerivedStore").get(a);this.state.computedState!==a&&this.setState({computedState:a})};return c}(b("React").Component);e.exports=a}),null);
__d("SRFunctionRef",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}e.exports=a}),null);
__d("ChatSidebar.react",["BaseChatSidebar.react","ChatSidebarOrderedList.react","React","SRFunctionRef"],(function(a,b,c,d,e,f){"use strict";function a(a){return b("React").createElement(b("BaseChatSidebar.react"),{root:a.root,heightOffset:0},b("SRFunctionRef")(function(a){var c=a.computedState,d=a.hide;a=a.onMouseEnterItem;return b("React").createElement(b("ChatSidebarOrderedList.react"),{adminedPages:c.adminedPages,marketplaceThreads:c.marketplaceThreads,availableUsers:c.availableUsers,groups:c.groups,hide:d,isAfterDomLoad:c.isAfterDomLoad,isSidebar:!0,isUserOffline:c.isUserOffline,maxItemSlots:c.maxItemSlots+1,nearby:c.nearby,offlineUsers:c.offlineUsers,onMouseEnterItem:a,pageListModule:c.pageListModule,pymmList:c.pymmList,recentCalls:c.recentCalls,topUsers:c.topUsers,usersDetailedData:c.usersDetailedData,workOthers:c.workOthers})}))}e.exports=a}),null);